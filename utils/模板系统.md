## 模板系统

### 什么是模板

我喜欢这样描述模板引擎（系统）：

1. 给定一个模板字符串，不同于一般的字符串，该字符串存在一些__规则__，并且需要填充__数据__或者__逻辑__：
```js
const tpl = 'hello {{name}}'
```
> `{{variable}}`就描述了一个规则：插值（interpolation），`{{}}`括号内的变量将在之后被替换。
2. 通过一个渲染器对该模板进行渲染并返回最终需要呈现的内容，渲染器通常需要知道两件事儿：（1）待渲染模板 （2）待填充数据：
```js
const data = {name: 'wxj'};
const content = render(tpl, data);
// => 'hello wxj'
```

由此，，我们不难得出模板系统核心在于__规则__及__渲染器__。

### 实现一个基本的模板系统
#### 规则
有了上面的认识，我们现在可以着手开始实现一个基本的js模板系统，首先我们考虑定义规则：

- 插值：比如`{{name}}`直接用渲染数据进行替换，我们通过`{{}}`包裹

显然，解析规则我们需要利用到正则表达式，因此我们最终的规则定义如下：

```js
const rules = 
    interpolate: /{{([\s\S]+?)}}/
};

// 最终的匹配正则
const matcher = new RegExp([
    rules.interpolate.source
].join('|'), 'g');
```

### 渲染器
渲染器的核心逻辑很简单，就是遍历传入的**模板字符串**，当子串匹配到规则时，根据规则进行处理，最终返回一个新（渲染好的）字符串：

```js
function render (tpl, data) {
    return tpl.replace(matcher, (match, interpolate)=>{
        return data[interpolate];
    });
}
```

### 优化：支持模板插入代码
### 优化：预编译提升性能

刚才我们实现的模板系统，仅只是一个简单的“替换性”模板，他最大的不足在于：

### underscore中的`_.template()`